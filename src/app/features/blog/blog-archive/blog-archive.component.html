@if (hasError()) {
  <div class="blog-archive__error">
    <h2>Unable to load articles</h2>
    <p>We're having trouble loading the blog articles. Please try refreshing the page.</p>
    <button type="button" (click)="refreshPage()">Refresh Page</button>
  </div>
} @else {
<section class="blog-archive" aria-label="All GitPlumbers Articles">
  @if (isLoading()) {
    <app-loading-spinner [active]="true" message="Loading articles..."></app-loading-spinner>
  }
  <header class="blog-archive__hero">
    <p class="blog-archive__eyebrow">Archive</p>
    <h1>All GitPlumbers articles</h1>
    <p>
      Browse every modernisation insight, remediation playbook, and engineering field report we have published.
      Filter by topic, search by keyword, and sort the list to surface what your team needs next.
    </p>
  </header>

  <section class="blog-archive__controls" aria-label="Filter, search, and sort articles">
    <div class="blog-archive__control blog-archive__control--search">
      <label for="archive-search">Search</label>
      <input
        id="archive-search"
        type="search"
        inputmode="search"
        [value]="_blogStore.searchTerm()"
        (input)="onSearchChange($any($event.target).value)"
        placeholder="Search titles, summaries, or keywords"
      />
    </div>

    <div class="blog-archive__control">
      <label for="category-filter">Topic</label>
      <select
        id="category-filter"
        [value]="_blogStore.selectedCategory()"
        (change)="onCategoryChange($any($event.target).value)"
      >
        @for (option of categoryOptions; track option.slug) {
          <option [value]="option.slug">{{ option.label }}</option>
        }
      </select>
    </div>

    <div class="blog-archive__control">
      <label for="sort-filter">Sort by</label>
      <select
        id="sort-filter"
        [value]="_blogStore.sortOption()"
        (change)="onSortChange($any($event.target).value)"
      >
        @for (option of sortOptions; track option.id) {
          <option [value]="option.id">{{ option.label }}</option>
        }
      </select>
    </div>

    <p class="blog-archive__count" aria-live="polite">{{ paginationState().totalItems }} articles</p>
  </section>

  @if (isLoading()) {
    <div class="blog-archive__skeleton" aria-label="Loading articles">
      @for (item of skeletonItems(); track $index) {
        <div class="blog-archive__skeleton-item">
          <p-skeleton width="60%" height="0.75rem" class="blog-archive__skeleton-line--short" />
          <p-skeleton width="80%" height="1.25rem" class="blog-archive__skeleton-line--medium" />
          <p-skeleton width="100%" height="1rem" class="blog-archive__skeleton-line--long" />
          <p-skeleton width="100%" height="1rem" class="blog-archive__skeleton-line--long" />
          <p-skeleton width="100%" height="1rem" class="blog-archive__skeleton-line--long" />
          <p-skeleton width="40%" height="0.85rem" class="blog-archive__skeleton-line--meta" />
          <p-skeleton width="25%" height="1rem" />
        </div>
      }
    </div>
  } @else if (totalVisiblePosts() === 0) {
    <div class="blog-archive__empty">
      <p>No articles match that combination yet. Try another topic or reset the filters.</p>
      @if (hasActiveSearch()) {
        <button type="button" class="blog-archive__reset" (click)="clearSearch()">Clear search</button>
      }
    </div>
  } @else {
    <ul class="blog-archive__list">
      @for (post of paginatedPosts().items; track post.slug) {
        <li class="blog-archive__item">
          <article>
            <p class="blog-archive__category">{{ post.categorySlug | titlecase }}</p>
            <h2>
              <a [routerLink]="['/blog', post.slug]">{{ post.title }}</a>
            </h2>
            <p class="blog-archive__summary">{{ post.summary }}</p>
            <p class="blog-archive__meta">
              {{ post.publishedOn | date: 'MMM d, y' }} | {{ post.readTime }}
            </p>
            <a [routerLink]="['/blog', post.slug]" class="blog-archive__read">Read article</a>
          </article>
        </li>
      }
    </ul>

    <app-pagination
      [pagination]="paginationState()"
      [controls]="paginationControls()"
      [showInfo]="true"
      [showFirstLast]="true"
      [showPrevNext]="true"
      (pageChange)="onPageChange($event)"
      (firstPage)="onFirstPage()"
      (previousPage)="onPreviousPage()"
      (nextPage)="onNextPage()"
      (lastPage)="onLastPage()"
    ></app-pagination>
  }
</section>
}
