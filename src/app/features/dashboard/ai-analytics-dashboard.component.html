<div class="ai-analytics-dashboard">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1>ü§ñ AI Analytics Dashboard</h1>
      <p class="subtitle">Track AI-driven traffic and content performance</p>
    </div>
    <button class="refresh-btn" (click)="refreshDashboard()" [disabled]="isLoading()">
      <span class="refresh-icon" [class.spinning]="isLoading()">üîÑ</span>
      Refresh
    </button>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
  <div class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading AI analytics data...</p>
  </div>
  }

  <!-- Error State -->
  @if (error()) {
  <div class="error-container">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h3>Error Loading Data</h3>
    <p>{{ error() }}</p>
    <button class="retry-btn" (click)="refreshDashboard()">Try Again</button>
  </div>
  }

  <!-- Dashboard Content -->
  @if (!isLoading() && !error() && dashboard()) {
  <!-- Summary Cards -->
  <div class="summary-cards">
    <div class="metric-card primary">
      <div class="metric-icon">ü§ñ</div>
      <div class="metric-content">
        <h3>{{ formatNumber(totalAiTraffic()) }}</h3>
        <p>Total AI Traffic</p>
        <div class="trend-indicator" [class]="growthIndicator().class">
          <span class="trend-icon">{{ growthIndicator().icon }}</span>
          <span class="trend-text">{{ growthIndicator().text }}</span>
          <span class="trend-value">{{ formatPercentage(getAbsoluteValue(growthTrend())) }}</span>
        </div>
      </div>
    </div>

    <div class="metric-card success">
      <div class="metric-icon">üéØ</div>
      <div class="metric-content">
        <h3>{{ formatNumber(totalConversions()) }}</h3>
        <p>AI Conversions</p>
        <div class="conversion-rate">
          <span class="rate-label">Conversion Rate:</span>
          <span class="rate-value">{{ formatPercentage(conversionRate()) }}</span>
        </div>
      </div>
    </div>

    <div class="metric-card info">
      <div class="metric-icon">üìä</div>
      <div class="metric-content">
        <h3>{{ topAiSources().length }}</h3>
        <p>AI Sources</p>
        <div class="top-source">
          @if (topAiSources().length > 0) {
          <span class="source-icon">{{ getSourceIcon(topAiSources()[0].source) }}</span>
          <span class="source-name">{{ topAiSources()[0].source }}</span>
          }
        </div>
      </div>
    </div>

    <div class="metric-card warning">
      <div class="metric-icon">üìù</div>
      <div class="metric-content">
        <h3>{{ recentCitations().length }}</h3>
        <p>Recent Citations</p>
        <div class="citation-count">
          <span class="count-label">Last 30 days</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="charts-section">
    <div class="chart-container">
      <h3>üìà AI Traffic Trends (30 Days)</h3>
      <div class="chart-placeholder">
        <div class="chart-data">
          @for (metric of dailyMetrics(); track metric.date) {
          <div class="chart-bar">
            <div class="bar-label">{{ formatDate(metric.date) }}</div>
            <div class="bar-container">
              <div
                class="bar ai-traffic"
                [style.height.%]="getAiTrafficPercentage(metric.aiTrafficEvents)"
              ></div>
              <div
                class="bar conversions"
                [style.height.%]="getConversionPercentage(metric.conversionEvents)"
              ></div>
            </div>
            <div class="bar-values">
              <span class="ai-value">{{ metric.aiTrafficEvents }}</span>
              <span class="conv-value">{{ metric.conversionEvents }}</span>
            </div>
          </div>
          }
        </div>
        <div class="chart-legend">
          <div class="legend-item">
            <div class="legend-color ai-traffic"></div>
            <span>AI Traffic</span>
          </div>
          <div class="legend-item">
            <div class="legend-color conversions"></div>
            <span>Conversions</span>
          </div>
        </div>
      </div>
    </div>

    <div class="chart-container">
      <h3>üéØ AI Sources Breakdown</h3>
      <div class="sources-chart">
        @for (source of topAiSources(); track source.source) {
        <div class="source-item">
          <div class="source-info">
            <span class="source-icon">{{ getSourceIcon(source.source) }}</span>
            <span class="source-name">{{ source.source }}</span>
          </div>
          <div class="source-bar">
            <div
              class="source-fill"
              [style.width.%]="getSourcePercentage(source.visits)"
              [style.background-color]="getSourceColor(source.source)"
            ></div>
          </div>
          <div class="source-value">{{ formatNumber(source.visits) }}</div>
        </div>
        }
      </div>
    </div>
  </div>

  <!-- Recent Citations -->
  <div class="citations-section">
    <h3>üìù Recent AI Citations</h3>
    @if (recentCitations().length > 0) {
    <div class="citations-list">
      @for (citation of recentCitations(); track citation.timestamp) {
      <div class="citation-item">
        <div class="citation-header">
          <span class="citation-platform"
            >{{ getSourceIcon(citation.platform) }} {{ citation.platform }}</span
          >
          <span class="citation-date">{{ formatDateTime(citation.timestamp) }}</span>
        </div>
        <div class="citation-content">
          <p>{{ truncateText(citation.content, 150) }}</p>
        </div>
        <div class="citation-meta">
          <span class="citation-url">{{ citation.url }}</span>
          @if (citation.query) {
          <span class="citation-query">Query: "{{ citation.query }}"</span>
          }
        </div>
      </div>
      }
    </div>
    } @else {
    <div class="no-citations">
      <div class="no-citations-icon">üì≠</div>
      <p>No recent AI citations found</p>
    </div>
    }
  </div>

  <!-- Performance Insights -->
  @if (performanceInsights().length > 0) {
  <div class="insights-section">
    <h3>üí° Performance Insights</h3>
    <div class="insights-list">
      @for (insight of performanceInsights(); track insight) {
      <div class="insight-item">
        <span class="insight-icon">üí°</span>
        <p>{{ insight }}</p>
      </div>
      }
    </div>
  </div>
  } }
</div>
